angular.module("MultipleChoice",["ngAnimate","ionic","multipleChoice.services","multipleChoice.controllers"])

.config(
    ["$stateProvider","$urlRouterProvider",
        function($stateProvider,$urlRouterProvider)
        {$stateProvider
            .state("tab",{url:"/tab","abstract":true,templateUrl:"templates/tabs.html"})
            .state("tab.questions",{url:"/questions",views:{"quiz-tab":{templateUrl:"templates/quiz.html",controller:"QuizCtrl"}}})
            .state("tab.question",{url:"/question/:questionId",views:{"quiz-tab":{templateUrl:"templates/question.html",controller:"QuestionCtrl"}}})
            .state("tab.results",{url:"/results",views:{"quiz-tab":{templateUrl:"templates/results.html",controller:"ResultsCtrl"}}})
            .state("tab.home",{url:"/home",views:{"home-tab":{templateUrl:"templates/home.html"}}})
            .state("tab.about",{url:"/about",views:{"about-tab":{templateUrl:"templates/about.html"}}}),
            
            $urlRouterProvider.otherwise("/tab/home")}
            ]
),
        
        
angular.module("multipleChoice.controllers",[])
        
        
.controller("QuizCtrl",["$scope","$log","QuizService",function($scope,b,QuizService){$scope.questions=QuizService.all()}])

.controller("QuestionCtrl",["$scope","$log","$stateParams","$ionicModal","QuizService",
                         function($scope,$log,$stateParams,$ionicModal,QuizService)
            {
              $scope.test="test",
              $scope.question=QuizService.get($stateParams.questionId),
              $scope.numberOfQuestions=QuizService.all().length,
              $scope.modal,
              $scope.currentOption=-1,
              $scope.optionSelected=
                    function($ionicModal) 
                        { 
                        $log.info("item: ",$ionicModal.id);
                        var f=$scope.question.options[$ionicModal.id].answer;
                        $log.info("correct answer : "+f),
                        QuizService.mark($stateParams.questionId,f)
                        },
               
               $ionicModal.fromTemplateUrl( "modal.html",
                                                            function(c){$scope.info("setting up the modal window!"),$scope.modal=$stateParams},
                                                           {scope:$scope,animation:"slide-in-up"}),
                                                           
               $scope.openModal=function(){ $log.info("open the bloody window! || ",$scope.modal),
                                                             $scope.title=$scope.question.title,
                                                             $scope.text=$scope.question.text,
                                                             $scope.image=$scope.question.image,
                                                             $scope.modal.show()},
                                                             
               $scope.$on("$destroy",function(){$scope.modal.remove()})}])
               
               
.controller("ResultsCtrl",["$scope","$log","$stateParams","$state","QuizService",function($scope,$log,$stateParams,$state,QuizService)
                   {$scope.numberOfQuestions=QuizService.all().length,
                     $scope.numberOfCorrectAnswers=QuizService.getNumberOfCorrectAnswers(),
                     $scope.reset=function(){QuizService.reset(),$state.transitionTo("ta$log.questions")}}]),
                     
                     
           
angular.module("multipleChoice.services",[])
               .factory("QuizService",function()
               {var Qdb=[{id:0,title:"The Tudors",text:"Do you know how many wives did HenryVIII have?",correct:false,image:"henryviii.png",
                                 options:[{id:0,text:"1",answer:false},
                                              {id:1,text:"3",answer:false},
                                              {id:2,text:"6",answer:true},
                                              {id:3,text:"13",answer:false}]},
                            {id:1,title:"The Romans",text:"Which Roman Emperor built a massive wall across Northern Britain in 122 A.D.?",correct:false,image:"hadrianswall.png",
                                 options:[{id:0,text:"Marcus Aurelius",answer:false},
                                              {id:1,text:"Hadrian",answer:true},
                                              {id:2,text:"Nero",answer:false},
                                              {id:3,text:"Augustus",answer:false}]},
                            {id:2,title:"The Elizabethans",text:"In 1594 William Shakespeare joined the company of this London theatre.",correct:false,image:"globe.png",
                                 options:[{id:0,text:"Broadway",answer:false},
                                              {id:1,text:"Oxford University Theatre",answer:false},
                                              {id:2,text:"The Globe",answer:true},
                                              {id:3,text:"The London Palladium",answer:false}]},
                            {id:3,title:"The Renaissance",text:"The first successful printing press was developed by this man.",correct:false,image:"gutenberg.png",
                                 options:[{id:0,text:"Johannes Gutenburg",answer:true},
                                              {id:1,text:"Benjamin Franklin",answer:false},
                                              {id:2,text:"Sir Isaac Newton",answer:false},
                                              {id:3,text:"Martin Luther",answer:false}]}];
                               return{
                                   all:function(){return Qdb},
                                   get:function(index){return Qdb[index]},
                                   mark:function(index,c){Qdb[index].correct=c},
                                   getNumberOfCorrectAnswers:function(){for(var b,c=0,i=0;i<Qdb.length;i++)b=Qdb[i],b.correct&&c++;return c},
                                   reset:function(){for(var i=0;i<Qdb.length;i++)Qdb[i].correct=false}}});